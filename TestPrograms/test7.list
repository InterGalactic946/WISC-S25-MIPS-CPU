///////////////////////////////////////////////////////
// Branch Hazard Test Program (Register & Condition) //
// This program demonstrates register and condition  //
// hazards in a pipelined processor.                 //
///////////////////////////////////////////////////////

// Initialize registers
LLB R1, 0x05      // Loop counter (R1 = 5 elements)
LLB R2, 0x00      // Register used in branch condition (R2 = 0)
LLB R3, 0x00      // Accumulator for addition (R3 = 0)
LLB R4, 0x01      // Constant for incrementing (R4 = 1)
LLB R5, 0x02      // Another constant for incrementing (R5 = 2)

// Test Register Hazard with LW (load word instruction)
TEST_LW_HAZARD:
    LW R2, R1, 0    // Load value from memory[0x00] into R2 (e.g., R2 = value from address 0)
    BR 000, R2      // Branch if Not Equal (Z = 0) → should branch if R2 != 0

    // Code after branch (if branch not taken)
    ADD R3, R3, R4  // This should execute if branch not taken

// Test Register Hazard with RED (reduction instruction)
TEST_RED_HAZARD:
    RED R2, R3, R0  // Reduce R3, result stored in R2
    BR 000, R2      // Branch if Not Equal (Z = 0) → should branch if R2 != 0

    // Code after branch (if branch not taken)
    ADD R3, R3, R4  // This should execute if branch not taken

// Test Register Hazard with PADDSB (parallel addition signed bytes)
TEST_PADDSB_HAZARD:
    PADDSB R2, R3, R4  // Parallel add signed bytes (R2 = R3 + R4)
    BR 000, R2         // Branch if Not Equal (Z = 0) → should branch if R2 != 0

    // Code after branch (if branch not taken)
    ADD R3, R3, R4     // This should execute if branch not taken

// Test Condition Code Hazard with ADD (affects condition flags)
TEST_ADD_HAZARD:
    ADD R2, R1, R4    // R2 = R1 + R4, affects condition codes (Z, N)
    BR 001, R2        // Branch if Equal (Z = 1) → should branch if Z = 1 (R2 = 0)
    
    // Code after branch (if branch not taken)
    ADD R3, R3, R4    // This should execute if branch not taken

// Test Condition Code Hazard with SUB (affects condition flags)
TEST_SUB_HAZARD:
    SUB R2, R1, R4    // R2 = R1 - R4, affects condition codes (Z, N)
    BR 001, R2        // Branch if Equal (Z = 1) → should branch if Z = 1 (R2 = 0)

    // Code after branch (if branch not taken)
    ADD R3, R3, R4    // This should execute if branch not taken

// Test Both Register and Condition Code Hazard with ADD
TEST_BOTH_ADD_HAZARD:
    ADD R1, R1, R4    // R1 = R1 + R4, affects condition codes (Z, N) and modifies R1
    BR 001, R1        // Branch if Equal (Z = 1) → should branch if R1 = 0 (Z = 1)
    
    // Code after branch (if branch not taken)
    ADD R3, R3, R4    // This should execute if branch not taken

// Test Both Register and Condition Code Hazard with SUB
TEST_BOTH_SUB_HAZARD:
    SUB R1, R1, R4    // R1 = R1 - R4, affects condition codes (Z, N) and modifies R1
    BR 001, R1        // Branch if Equal (Z = 1) → should branch if R1 = 0 (Z = 1)

    // Code after branch (if branch not taken)
    ADD R3, R3, R4    // This should execute if branch not taken

END:
HLT                // Halt execution
